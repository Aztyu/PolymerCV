<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../custom_components/cvProjectcomponent.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<dom-module id="cv-projects-component">
    <style>
        .wrapper{
        @apply(--layout-wrap);
            @apply(--layout-horizontal);
            width: 90%;
            margin: auto;
        }

        .boxes{
            @apply(--layout-wrap);
            @apply(--layout-horizontal);
            color: white;
            margin: 0 0 0 0;
            padding: 8px 16px 8px 16px;
            background-color: #1E88E5;
        }

        .blue{
            margin: 0 0 0 0;
            padding: 4px 8px 4px 8px;
            color: white;
            background-color: #1E88E5;
        }

        paper-checkbox{
            margin: 8px 8px 8px 8px;
            --paper-checkbox-label-color: white;
        }

        cv-project-component{
            min-width: 550px;
            margin-top: 16px;
            margin-bottom: 16px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>

    <template>
        <p class="blue">Filtres :</p>
        <div class="boxes">
            <template is="dom-repeat" items="{{categories}}" as="category" observe="show">
                <paper-checkbox on-iron-change="test" checked="{{category.show}}">{{category.text}}</paper-checkbox>
            </template>
        </div>

        <div class="wrapper">
            <template is="dom-repeat" items="{{data}}" as="data" filter="filtre" observe="show">
                <cv-project-component git_link={{data.link}} image={{data.image}} title={{data.title}} desc={{data.desc}}></cv-project-component>
            </template>
        </div>

    </template>
</dom-module>

<script>


    Polymer({
        is: "cv-projects-component",

        properties: {
            description: Array,
            data:{
                type: Array,
                value: {},
                notify: true
            },
            categories:{
                type: Array,
                value:[
                    {text: "C/C++", category: "cpp", show: true},
                    {text: "Java", category: "java", show: true},
                    {text: "Web", category: "web", show: true},
                    {text: "C#", category: "csharp", show: true},
                    {text: "SEO", category: "seo", show: true},
                    {text: "Swift", category: "swift", show: true}
                ],
                notify: true,
                observer: 'showchanged'
            }
        },

        updateCategoryFromCheckbox: function(category, show){
            for(var i = 0; i<this.data.length; i++) {
                if (this.data[i].category == category) {
                    console.log(this.data[i])
                    console.log("data :" + category + ", " + show);
                    this.set('data.' + i + '.show', show);
                }
            }
        },

        updateCategory: function(category, show){
            for(var i = 0; i<this.data.length; i++) {
                if(this.categories[i] !== undefined){
                    if (this.categories[i].category == category) {
                        console.log(this.data[i])
                        console.log("data :" + category + ", " + show);
                        this.set('categories.' + i + '.show', show);
                    }
                }
            }
        },

        filtre: function(item){
            for(var i = 0; i<this.categories.length; i++) {
                if (this.categories[i].category == item.category && this.categories[i].show != item.show) {
                    console.log("Update filter");
                    this.set('categories.' + i + '.show', item.show);
                }
            }
            return item.show;
        },

        showchanged: function(item){
            console.log("Data changed ");
            console.log(item);
            for(var i=0; i<item.length; i++){
                this.updateCategory(item[i].category, item[i].show);
            }
        },

        test: function(item) {
            category = item.target.innerText;
            while (category.charAt(0) == ' ') {
                category = category.substr(1);
            }
            console.log(category);
            for(var i=0; i<this.categories.length; i++){
                if(this.categories[i].text == category){
                    console.log("found");
                    this.updateCategoryFromCheckbox(this.categories[i].category, this.categories[i].show);
                }
            }
        }
    })
</script>