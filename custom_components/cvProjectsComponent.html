<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="../custom_components/cvProjectcomponent.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">

<dom-module id="cv-projects-component">
    <style>
        .wrapper{
        @apply(--layout-wrap);
            @apply(--layout-horizontal);
            width: 90%;
            margin: auto;
        }

        .boxes{
            @apply(--layout-wrap);
            @apply(--layout-horizontal);
            color: white;
            margin: 0 0 0 0;
            padding: 8px 16px 8px 16px;
            background-color: #1E88E5;
        }

        .blue{
            margin: 0 0 0 0;
            padding: 4px 8px 4px 8px;
            color: white;
            background-color: #1E88E5;
        }

        paper-checkbox{
            margin: 8px 8px 8px 8px;
            --paper-checkbox-label-color: white;
        }

        cv-project-component{
            min-width: 550px;
            margin-top: 16px;
            margin-bottom: 16px;
            margin-left: auto;
            margin-right: auto;
        }
    </style>

    <template>
      <iron-ajax
              id="projectrequest"
              url="{{ajaxurl}}"
              handle-as="json"
              last-response="{{resource}}"></iron-ajax>

        <p class="blue">{{resource.filter}}</p>
        <div class="boxes">
            <template is="dom-repeat" items="{{categories}}" as="category" observe="show">
                <paper-checkbox on-iron-change="checkboxChanged" checked="{{category.show}}">{{category.text}}</paper-checkbox>
            </template>
        </div>

        <div class="wrapper">
            <template is="dom-repeat" items="{{resource.projects}}" as="data" filter="filtre" observe="show">
                <cv-project-component desc={{data.desc}} linktext="{{resource.linktext}}" gitlink={{data.link}} image={{data.image}} title={{data.title}} desc={{data.desc}}></cv-project-component>
            </template>
        </div>

    </template>
</dom-module>

<script>


    Polymer({
        is: "cv-projects-component",

        properties: {
            resource:{
              type: Object,
              notify: true
            },
            categories:{
                type: Array,
                value:[
                    {text: "C/C++", category: "cpp", show: true},
                    {text: "Java", category: "java", show: true},
                    {text: "Web", category: "web", show: true},
                    {text: "C#", category: "csharp", show: true},
                    {text: "SEO", category: "seo", show: true}
                ],
                notify: true,
                observer: 'showchanged'
            },
            language:{
              type: String,
              notify: true,
              observer: "languageChanged"
            },
            ajaxurl:{
                type: String,
                value: "json/fr/home.json"
            }
        },

        ready: function(){
            this.$.projectrequest.generateRequest();
        },

        languageChanged: function(){
            if(this.language === "english"){
                this.set('ajaxurl', "json/en/project.json");
                this.$.projectrequest.generateRequest();
            }else if(this.language === "french"){
                this.set('ajaxurl', "json/fr/project.json");
                this.$.projectrequest.generateRequest();
            }
        },

        updateCategoryFromCheckbox: function(category, show){
            if(this.resource.projects !== undefined){
                for(var i = 0; i<this.resource.projects.length; i++) {
                    if (this.resource.projects[i].category == category) {
                        this.set('resource.projects.' + i + '.show', show);
                    }
                }
            }
        },

        updateCategory: function(category, show){
          if(this.resource !== undefined){
            for(var i = 0; i<this.resource.projects.length; i++) {
                if(this.resource.projects[i] !== undefined){
                    if (this.resource.projects[i].category == category) {
                        this.set('resource.projects.' + i + '.show', show);
                    }
                }
            }
          }
        },

        filtre: function(item){
            for(var i = 0; i<this.categories.length; i++) {
                if (this.categories[i].category == item.category && this.categories[i].show != item.show) {
                    this.set('categories.' + i + '.show', item.show);
                }
            }
            return item.show;
        },

        showchanged: function(item){
            for(var i=0; i<item.length; i++){
                this.updateCategory(item[i].category, item[i].show);
            }
        },

        checkboxChanged: function(item) {
            category = item.target.innerText;
            while (category.charAt(0) == ' ') {
                category = category.substr(1);
            }
            for(var i=0; i<this.categories.length; i++){
                if(this.categories[i].text == category){
                    this.updateCategoryFromCheckbox(this.categories[i].category, this.categories[i].show);
                }
            }
        }
    })
</script>
